<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.9.2">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="raven">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="raven">
  <title>raven master</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          raven
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="raven/Exception" data-name="exception">
      <a href="Exception.html">Exception</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven" data-name="raven">
      <a href="Raven.html">Raven</a>
      
        <ul>
  
  <li class="parent " data-id="raven/Raven/Breadcrumb" data-name="raven::breadcrumb">
      <a href="Raven/Breadcrumb.html">Breadcrumb</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Breadcrumb/Severity" data-name="raven::breadcrumb::severity">
      <a href="Raven/Breadcrumb/Severity.html">Severity</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Breadcrumb/Type" data-name="raven::breadcrumb::type">
      <a href="Raven/Breadcrumb/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="raven/Raven/BreadcrumbBuffer" data-name="raven::breadcrumbbuffer">
      <a href="Raven/BreadcrumbBuffer.html">BreadcrumbBuffer</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Client" data-name="raven::client">
      <a href="Raven/Client.html">Client</a>
      
        <ul>
  
  <li class="parent " data-id="raven/Raven/Client/State" data-name="raven::client::state">
      <a href="Raven/Client/State.html">State</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Client/State/Status" data-name="raven::client::state::status">
      <a href="Raven/Client/State/Status.html">Status</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="raven/Raven/Configuration" data-name="raven::configuration">
      <a href="Raven/Configuration.html">Configuration</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Configuration/Encoding" data-name="raven::configuration::encoding">
      <a href="Raven/Configuration/Encoding.html">Encoding</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="raven/Raven/Context" data-name="raven::context">
      <a href="Raven/Context.html">Context</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Delegators" data-name="raven::delegators">
      <a href="Raven/Delegators.html">Delegators</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Error" data-name="raven::error">
      <a href="Raven/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Event" data-name="raven::event">
      <a href="Raven/Event.html">Event</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Event/HashType" data-name="raven::event::hashtype">
      <a href="Raven/Event/HashType.html">HashType</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Event/Hint" data-name="raven::event::hint">
      <a href="Raven/Event/Hint.html">Hint</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Event/Severity" data-name="raven::event::severity">
      <a href="Raven/Event/Severity.html">Severity</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="raven/Raven/Instance" data-name="raven::instance">
      <a href="Raven/Instance.html">Instance</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Interface" data-name="raven::interface">
      <a href="Raven/Interface.html">Interface</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Interface/Exception" data-name="raven::interface::exception">
      <a href="Raven/Interface/Exception.html">Exception</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Interface/HTTP" data-name="raven::interface::http">
      <a href="Raven/Interface/HTTP.html">HTTP</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Interface/Message" data-name="raven::interface::message">
      <a href="Raven/Interface/Message.html">Message</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Interface/SingleException" data-name="raven::interface::singleexception">
      <a href="Raven/Interface/SingleException.html">SingleException</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Interface/Stacktrace" data-name="raven::interface::stacktrace">
      <a href="Raven/Interface/Stacktrace.html">Stacktrace</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Interface/Stacktrace/Frame" data-name="raven::interface::stacktrace::frame">
      <a href="Raven/Interface/Stacktrace/Frame.html">Frame</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="raven/Raven/LogBackend" data-name="raven::logbackend">
      <a href="Raven/LogBackend.html">LogBackend</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Mixin" data-name="raven::mixin">
      <a href="Raven/Mixin.html">Mixin</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Mixin/InitializeWith" data-name="raven::mixin::initializewith">
      <a href="Raven/Mixin/InitializeWith.html">InitializeWith</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="raven/Raven/Processor" data-name="raven::processor">
      <a href="Raven/Processor.html">Processor</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Processor/Compact" data-name="raven::processor::compact">
      <a href="Raven/Processor/Compact.html">Compact</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/Cookies" data-name="raven::processor::cookies">
      <a href="Raven/Processor/Cookies.html">Cookies</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/HTTPHeaders" data-name="raven::processor::httpheaders">
      <a href="Raven/Processor/HTTPHeaders.html">HTTPHeaders</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/RemoveCircularReferences" data-name="raven::processor::removecircularreferences">
      <a href="Raven/Processor/RemoveCircularReferences.html">RemoveCircularReferences</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/RemoveStacktrace" data-name="raven::processor::removestacktrace">
      <a href="Raven/Processor/RemoveStacktrace.html">RemoveStacktrace</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/RequestMethodData" data-name="raven::processor::requestmethoddata">
      <a href="Raven/Processor/RequestMethodData.html">RequestMethodData</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/SanitizeData" data-name="raven::processor::sanitizedata">
      <a href="Raven/Processor/SanitizeData.html">SanitizeData</a>
      
    </li>
  
  <li class=" " data-id="raven/Raven/Processor/UTF8Conversion" data-name="raven::processor::utf8conversion">
      <a href="Raven/Processor/UTF8Conversion.html">UTF8Conversion</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="raven/Raven/Transport" data-name="raven::transport">
      <a href="Raven/Transport.html">Transport</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Transport/Dummy" data-name="raven::transport::dummy">
      <a href="Raven/Transport/Dummy.html">Dummy</a>
      
    </li>
  
  <li class="parent " data-id="raven/Raven/Transport/HTTP" data-name="raven::transport::http">
      <a href="Raven/Transport/HTTP.html">HTTP</a>
      
        <ul>
  
  <li class=" " data-id="raven/Raven/Transport/HTTP/Error" data-name="raven::transport::http::error">
      <a href="Raven/Transport/HTTP/Error.html">Error</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p align="center">
  <img src="https://sija.github.io/raven.cr/img/bug-fixing.svg" height="300" alt="Bug fixing illustration" />
</p>
<h1 align="center">
  raven.cr • the Crystal client for Sentry
</h1>
<p align="center">
  <a href="https://github.com/Sija/raven.cr/actions?query=workflow%3ACI"><img src="https://github.com/Sija/raven.cr/workflows/CI/badge.svg" alt="Build Status" /></a>
  <a href="https://www.codacy.com/app/Sija/raven.cr"><img src="https://api.codacy.com/project/badge/Grade/32cb8814a14d4a6cbe39d6768142c59b" alt="Codacy Badge" /></a>
  <a href="https://github.com/Sija/raven.cr/releases"><img src="https://img.shields.io/github/release/Sija/raven.cr.svg" alt="Releases" /></a>
  <a href="https://github.com/Sija/raven.cr/blob/master/LICENSE"><img src="https://img.shields.io/github/license/Sija/raven.cr.svg" alt="License" /></a>
  <a href="https://gitter.im/raven-cr/Lobby"><img src="https://img.shields.io/gitter/room/raven-cr/Lobby.svg" alt="Gitter Chat" /></a>
</p>
<p>An unofficial Crystal-language client and integration layer for the <a href="https://github.com/getsentry/sentry">Sentry</a> error reporting API.</p>
<p>Based on fine <a href="https://github.com/getsentry/raven-ruby">raven-ruby</a> gem
from folks at <a href="https://github.com/getsentry">@getsentry</a>.</p>
<h3><a id="blog-posts" class="anchor" href="#blog-posts">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Blog posts</h3>
<ul>
<li><a href="https://sija.pl/en/notes/crystal-error-tracking-with-sentry">Crystal error tracking with Sentry</a></li>
<li><a href="https://sija.pl/en/notes/sentry-error-tracking-for-kemal">Sentry error tracking for Kemal</a></li>
</ul>
<h2><a id="features" class="anchor" href="#features">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Features</h2>
<ul>
<li>[x] Processors (data scrubbers)</li>
<li>[x] Interfaces (Message, Exception, Stacktrace, User, HTTP, ...)</li>
<li>[x] Contexts (user, tags, extra, os, runtime)</li>
<li>[x] Breadcrumbs</li>
<li>[x] Integrations (<a href="https://github.com/kemalcr/kemal">Kemal</a>, <a href="https://github.com/amberframework/amber">Amber</a>, <a href="https://github.com/luckyframework/lucky">Lucky</a>, <a href="https://github.com/mperham/sidekiq.cr">Sidekiq.cr</a>, <a href="https://github.com/spider-gazelle/action-controller">action-controller</a>)</li>
<li>[x] Async support</li>
<li>[x] User Feedback</li>
<li>[x] Source code context for stack traces</li>
<li>[x] Dedicated <a href="https://crystal-lang.org/api/Log.html"><code>Log</code></a> backend</li>
<li>[x] Crash Handler</li>
</ul>
<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>
<p>Add this to your application's <code>shard.yml</code>:</p>
<pre><code class="language-yaml">dependencies:
  raven:
    github: Sija/raven.cr</code></pre>
<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>
<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;raven&quot;</span></code></pre>
<h3><a id="raven-only-runs-when-sentry-dsn-is-set" class="anchor" href="#raven-only-runs-when-sentry-dsn-is-set">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Raven only runs when SENTRY_DSN is set</h3>
<p>Raven will capture and send exceptions to the Sentry server whenever its DSN is set.
This makes environment-based configuration easy - if you don't want to send
errors in a certain environment, just don't set the DSN in that environment!</p>
<pre><code class="language-sh"># Set your SENTRY_DSN environment variable.
export SENTRY_DSN=https://public@example.com/project-id</code></pre>
<pre><code class="language-crystal"><span class="c"># Or you can configure the client in the code (not recommended - keep your DSN secret!)</span>
<span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.dsn <span class="o">=</span> <span class="s">&quot;https://public@example.com/project-id&quot;</span>
<span class="k">end</span></code></pre>
<h3><a id="raven-doesnt-report-some-kinds-of-data-by-default" class="anchor" href="#raven-doesnt-report-some-kinds-of-data-by-default">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Raven doesn't report some kinds of data by default</h3>
<p>If used with integrations, Raven ignores some exceptions by default - most of
these are related to 404s or controller actions not being found.</p>
<p>Raven doesn't report <code>POST</code>, <code>PUT</code>, <code>PATCH</code> data or cookies by default.
In addition, it will attempt to remove any obviously sensitive data,
such as credit card or Social Security numbers.
For more information about how Sentry processes your data, <a href="https://docs.sentry.io/clients/ruby/config/">check out the documentation on the <code>processors</code> config setting.</a></p>
<h3><a id="call" class="anchor" href="#call">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Call</h3>
<p>Raven supports two methods of capturing exceptions:</p>
<pre><code class="language-crystal"><span class="t">Raven</span>.capture <span class="k">do</span>
  <span class="c"># capture any exceptions which happen during execution of this block</span>
  <span class="n">1</span> <span class="o">//</span> <span class="n">0</span>
<span class="k">end</span>

<span class="k">begin</span>
  <span class="n">1</span> <span class="o">//</span> <span class="n">0</span>
<span class="k">rescue</span> ex : <span class="t">DivisionByZeroError</span>
  <span class="t">Raven</span>.capture(ex)
<span class="k">end</span></code></pre>
<h3><a id="more-configuration" class="anchor" href="#more-configuration">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>More configuration</h3>
<p>You're all set - but there are a few more settings you may want to know about too!</p>
<h4><a id="dsn" class="anchor" href="#dsn">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>DSN</h4>
<p>While we advise that you set your Sentry DSN through the <code>SENTRY_DSN</code> environment
variable, there are two other configuration settings for controlling Raven:</p>
<pre><code class="language-crystal"><span class="c"># DSN can be configured as a config setting instead.</span>
<span class="c"># Place in config/initializers or similar.</span>
<span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.dsn <span class="o">=</span> <span class="s">&quot;your_dsn&quot;</span>
<span class="k">end</span></code></pre>
<p>And, while not necessary if using <code>SENTRY_DSN</code>, you can also provide an
<code>environments</code> setting. Raven will only capture events when
<code>SENTRY_ENVIRONMENT</code> matches an environment on the list.</p>
<pre><code class="language-crystal"><span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.environments <span class="o">=</span> <span class="s">%w(staging production)</span>
<span class="k">end</span></code></pre>
<h4><a id="async" class="anchor" href="#async">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>async</h4>
<p>When an error or message occurs, the notification is immediately sent to Sentry.
Raven can be configured to send asynchronously:</p>
<pre><code class="language-crystal"><span class="c"># define your own handler</span>
config.async <span class="o">=</span> <span class="o">-&gt;</span>(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span>) {
  spawn { <span class="t">Raven</span>.send_event(event) }
}
<span class="c"># or use default implementation based on fibers (i.e. the one above)</span>
config.async <span class="o">=</span> <span class="n">true</span></code></pre>
<p>If the <code>async</code> callback raises an exception, Raven will attempt to send synchronously.</p>
<p>We recommend creating a background job, using your background job processor,
that will send Sentry notifications in the background.
Rather than enqueuing an entire <code><a href="Raven/Event.html">Raven::Event</a></code> object, we recommend providing
the <code>Hash</code> representation of an event as a job argument.</p>
<p>Here’s an example for <em>Sidekiq.cr</em>:</p>
<pre><code class="language-crystal">config.async <span class="o">=</span> <span class="o">-&gt;</span>(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span>) {
  <span class="c"># enqueue the job with a hash...</span>
  <span class="t">SentryJob</span>.async.perform(event.to_hash)
  <span class="c"># or with JSON string</span>
  <span class="c"># SentryJob.async.perform(event.to_json)</span>
}

<span class="k">class</span> <span class="t">SentryJob</span>
  <span class="k">include</span> <span class="t">Sidekiq</span><span class="t">::</span><span class="t">Worker</span>

  sidekiq_options <span class="k">do</span> <span class="o">|</span>job<span class="o">|</span>
    job.queue <span class="o">=</span> <span class="s">&quot;sentry&quot;</span>
    job.retry <span class="o">=</span> <span class="n">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">perform</span>(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span><span class="t">::</span><span class="t">HashType</span>)
    <span class="t">Raven</span>.send_event(event)
  <span class="k">end</span>
<span class="k">end</span></code></pre>
<h4><a id="transport-failure-callback" class="anchor" href="#transport-failure-callback">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>transport_failure_callback</h4>
<p>If Raven fails to send an event to Sentry for any reason
(either the Sentry server has returned a 4XX or 5XX response),
this <code>Proc</code> will be called.</p>
<pre><code class="language-crystal">config.transport_failure_callback <span class="o">=</span> <span class="o">-&gt;</span>(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span><span class="t">::</span><span class="t">HashType</span>) {
  <span class="t">AdminMailer</span>.async.perform(<span class="s">&quot;Oh god, it&#39;s on fire!&quot;</span>, event)
}</code></pre>
<h4><a id="context" class="anchor" href="#context">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Context</h4>
<p>Much of the usefulness of Sentry comes from additional context data with the events.
Raven makes this very convenient by providing methods to set context data that
is then submitted automatically with all events.</p>
<p>There are three primary methods for providing request context:</p>
<pre><code class="language-crystal"><span class="c"># bind the logged in user</span>
<span class="t">Raven</span>.user_context email: <span class="s">&quot;foo@example.com&quot;</span>

<span class="c"># tag the request with something interesting</span>
<span class="t">Raven</span>.tags_context interesting: <span class="s">&quot;yes&quot;</span>

<span class="c"># provide a bit of additional context</span>
<span class="t">Raven</span>.extra_context happiness: <span class="s">&quot;very&quot;</span></code></pre>
<p>For more information, see <a href="https://docs.sentry.io/clients/ruby/context/">Context</a>.</p>
<h2><a id="log-backend" class="anchor" href="#log-backend">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>Log</code> backend</h2>
<p><code><a href="Raven/LogBackend.html">Raven::LogBackend</a></code> allows for intercepting log entries, and takes following options:</p>
<ul>
<li><code>record_breadcrumbs</code> - records every log entry as Breadcrumbs</li>
<li><code>capture_exceptions</code> - captures exceptions attached to the log entry</li>
<li><code>capture_all</code> - captures every log entry</li>
</ul>
<p>Every captured <code><a href="Exception.html">Exception</a></code> or a <code>Breadcrumb</code> will have corresponding fields mapped
directly from the original <code>Log::Entry</code>.</p>
<p>Metadata will be passed as <code>Event#tags</code> and <code>Breadcrumb#data</code>, respectively.</p>
<h3><a id="usage-1" class="anchor" href="#usage-1">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h3>
<pre><code class="language-crystal"><span class="c"># append it to the existing bindings</span>
<span class="t">Log</span>.builder.bind <span class="s">&quot;*&quot;</span>, <span class="n">:info</span>, <span class="t">Raven</span><span class="t">::</span><span class="t">LogBackend</span>.new(
  record_breadcrumbs: <span class="n">true</span>,
  capture_exceptions: <span class="n">false</span>,
  capture_all: <span class="n">false</span>,
)

<span class="c"># or bind it within the `Log.setup` block</span>
<span class="t">Log</span>.setup <span class="k">do</span> <span class="o">|</span>c<span class="o">|</span>
  <span class="c"># bind the regular io-based backend</span>
  c.bind <span class="s">&quot;*&quot;</span>, <span class="n">:info</span>, <span class="t">Log</span><span class="t">::</span><span class="t">IOBackend</span>.new

  <span class="c"># bind raven&#39;s backend</span>
  c.bind <span class="s">&quot;*&quot;</span>, <span class="n">:info</span>, <span class="t">Raven</span><span class="t">::</span><span class="t">LogBackend</span>.new(record_breadcrumbs: <span class="n">true</span>)
  c.bind <span class="s">&quot;*&quot;</span>, <span class="n">:warn</span>, <span class="t">Raven</span><span class="t">::</span><span class="t">LogBackend</span>.new(capture_exceptions: <span class="n">true</span>)
  c.bind <span class="s">&quot;*&quot;</span>, <span class="n">:fatal</span>, <span class="t">Raven</span><span class="t">::</span><span class="t">LogBackend</span>.new(capture_all: <span class="n">true</span>)
<span class="k">end</span></code></pre>
<p>See more in Crystal's <code>Log</code> <a href="https://crystal-lang.org/api/Log.html#configure-logging-explicitly-in-the-code">documentation</a>.</p>
<h2><a id="crash-handler" class="anchor" href="#crash-handler">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Crash Handler</h2>
<p>Since Crystal doesn't provide native handlers for unhandled exceptions
and segfaults, <em>raven.cr</em> introduces its own crash handler compiled as
external binary.</p>
<h3><a id="setup" class="anchor" href="#setup">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Setup</h3>
<p>The easiest way of using it is by adding the appropriate entry to the project's <code>shard.yml</code>:</p>
<pre><code class="language-yaml">targets:
  # other target definitions if any...

  sentry.crash_handler:
    main: lib/raven/src/crash_handler.cr</code></pre>
<p>With the above entry defined in <code>targets</code>, running <code>shards build</code> should result in
binary built in <code>bin/sentry.crash_handler</code>.</p>
<p><strong>NOTE</strong>: While building you might specify <code>SENTRY_DSN</code> env variable, which will be
compiled into the binary (as plain-text) and used by the handler.</p>
<pre><code class="language-sh">SENTRY_DSN=&lt;your_dsn&gt; shards build sentry.crash_handler</code></pre>
<p>Pass <code>--release</code> flag to disable debug messages.</p>
<h3><a id="usage-2" class="anchor" href="#usage-2">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h3>
<p>You need to run your app with previously built <code>bin/sentry.crash_handler</code> in
front.</p>
<pre><code class="language-sh">bin/sentry.crash_handler bin/your_app --some arguments --passed to your program</code></pre>
<p>As one would expect, <code>STDIN</code> is passed to the original process, while
<code>STDOUT</code> and <code>STDERR</code> are piped back from it.</p>
<p><strong>NOTE</strong>: You can always pass <code>SENTRY_DSN</code> env variable during execution
in case you didn't do it while building the wrapper.</p>
<h2><a id="more-information" class="anchor" href="#more-information">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>More Information</h2>
<ul>
<li><a href="https://docs.sentry.io/clients/ruby">Documentation</a></li>
<li><a href="https://github.com/Sija/raven.cr/issues">Bug Tracker</a></li>
<li><a href="https://github.com/Sija/raven.cr">Code Repository</a></li>
</ul>
<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>
<ol>
<li><a href="https://github.com/Sija/raven.cr/fork">Fork it</a></li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create a new <a href="https://github.com/Sija/raven.cr/pulls">Pull Request</a></li>
</ol>
<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>
<ul>
<li><a href="https://github.com/Sija">@Sija</a> Sijawusz Pur Rahnama - creator, maintainer</li>
</ul>
</div>
</body>
</html>
