<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta id="repository-name" content="github.com/Sija/raven.cr">
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="js/doc.js"></script>
  <title>README - github.com/Sija/raven.cr</title>
</head>
<body>

<div id="types-list">
  <div id="search-box">
    <input type="search" id="search-input" placeholder="Search...">
  </div>

  <ul>
    <li class="current"><a href="index.html">README</a></li>
  </ul>

  <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Exception" data-name="exception">
      <a href="Exception.html">Exception</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Logger" data-name="logger">
      <a href="Logger.html">Logger</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven" data-name="raven">
      <a href="Raven.html">Raven</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Backtrace" data-name="raven::backtrace">
      <a href="Raven/Backtrace.html">Backtrace</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Backtrace/Line" data-name="raven::backtrace::line">
      <a href="Raven/Backtrace/Line.html">Line</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Breadcrumb" data-name="raven::breadcrumb">
      <a href="Raven/Breadcrumb.html">Breadcrumb</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Breadcrumb/Severity" data-name="raven::breadcrumb::severity">
      <a href="Raven/Breadcrumb/Severity.html">Severity</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Breadcrumb/Type" data-name="raven::breadcrumb::type">
      <a href="Raven/Breadcrumb/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/BreadcrumbBuffer" data-name="raven::breadcrumbbuffer">
      <a href="Raven/BreadcrumbBuffer.html">BreadcrumbBuffer</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Client" data-name="raven::client">
      <a href="Raven/Client.html">Client</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Client/State" data-name="raven::client::state">
      <a href="Raven/Client/State.html">State</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Client/State/Status" data-name="raven::client::state::status">
      <a href="Raven/Client/State/Status.html">Status</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Configuration" data-name="raven::configuration">
      <a href="Raven/Configuration.html">Configuration</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Configuration/Encoding" data-name="raven::configuration::encoding">
      <a href="Raven/Configuration/Encoding.html">Encoding</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Context" data-name="raven::context">
      <a href="Raven/Context.html">Context</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Delegators" data-name="raven::delegators">
      <a href="Raven/Delegators.html">Delegators</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Error" data-name="raven::error">
      <a href="Raven/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Event" data-name="raven::event">
      <a href="Raven/Event.html">Event</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Event/HashType" data-name="raven::event::hashtype">
      <a href="Raven/Event/HashType.html">HashType</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Event/Severity" data-name="raven::event::severity">
      <a href="Raven/Event/Severity.html">Severity</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Instance" data-name="raven::instance">
      <a href="Raven/Instance.html">Instance</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Interface" data-name="raven::interface">
      <a href="Raven/Interface.html">Interface</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/Exception" data-name="raven::interface::exception">
      <a href="Raven/Interface/Exception.html">Exception</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/HTTP" data-name="raven::interface::http">
      <a href="Raven/Interface/HTTP.html">HTTP</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/Message" data-name="raven::interface::message">
      <a href="Raven/Interface/Message.html">Message</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/SingleException" data-name="raven::interface::singleexception">
      <a href="Raven/Interface/SingleException.html">SingleException</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Interface/Stacktrace" data-name="raven::interface::stacktrace">
      <a href="Raven/Interface/Stacktrace.html">Stacktrace</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/Stacktrace/Frame" data-name="raven::interface::stacktrace::frame">
      <a href="Raven/Interface/Stacktrace/Frame.html">Frame</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Interface/Template" data-name="raven::interface::template">
      <a href="Raven/Interface/Template.html">Template</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Kemal" data-name="raven::kemal">
      <a href="Raven/Kemal.html">Kemal</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Kemal/ExceptionHandler" data-name="raven::kemal::exceptionhandler">
      <a href="Raven/Kemal/ExceptionHandler.html">ExceptionHandler</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Kemal/LogHandler" data-name="raven::kemal::loghandler">
      <a href="Raven/Kemal/LogHandler.html">LogHandler</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Kemal/UserFeedbackHandler" data-name="raven::kemal::userfeedbackhandler">
      <a href="Raven/Kemal/UserFeedbackHandler.html">UserFeedbackHandler</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Logger" data-name="raven::logger">
      <a href="Raven/Logger.html">Logger</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Mixin" data-name="raven::mixin">
      <a href="Raven/Mixin.html">Mixin</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Mixin/InitializeWith" data-name="raven::mixin::initializewith">
      <a href="Raven/Mixin/InitializeWith.html">InitializeWith</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Processor" data-name="raven::processor">
      <a href="Raven/Processor.html">Processor</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/Compact" data-name="raven::processor::compact">
      <a href="Raven/Processor/Compact.html">Compact</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/Cookies" data-name="raven::processor::cookies">
      <a href="Raven/Processor/Cookies.html">Cookies</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/HTTPHeaders" data-name="raven::processor::httpheaders">
      <a href="Raven/Processor/HTTPHeaders.html">HTTPHeaders</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/PostData" data-name="raven::processor::postdata">
      <a href="Raven/Processor/PostData.html">PostData</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/RemoveCircularReferences" data-name="raven::processor::removecircularreferences">
      <a href="Raven/Processor/RemoveCircularReferences.html">RemoveCircularReferences</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/RemoveStacktrace" data-name="raven::processor::removestacktrace">
      <a href="Raven/Processor/RemoveStacktrace.html">RemoveStacktrace</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/SanitizeData" data-name="raven::processor::sanitizedata">
      <a href="Raven/Processor/SanitizeData.html">SanitizeData</a>
      
    </li>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Processor/UTF8Conversion" data-name="raven::processor::utf8conversion">
      <a href="Raven/Processor/UTF8Conversion.html">UTF8Conversion</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Sidekiq" data-name="raven::sidekiq">
      <a href="Raven/Sidekiq.html">Sidekiq</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Sidekiq/ExceptionHandler" data-name="raven::sidekiq::exceptionhandler">
      <a href="Raven/Sidekiq/ExceptionHandler.html">ExceptionHandler</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Transport" data-name="raven::transport">
      <a href="Raven/Transport.html">Transport</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Transport/Dummy" data-name="raven::transport::dummy">
      <a href="Raven/Transport/Dummy.html">Dummy</a>
      
    </li>
  
  <li class="parent " data-id="github.com/Sija/raven.cr/Raven/Transport/HTTP" data-name="raven::transport::http">
      <a href="Raven/Transport/HTTP.html">HTTP</a>
      
        <ul>
  
  <li class=" " data-id="github.com/Sija/raven.cr/Raven/Transport/HTTP/Error" data-name="raven::transport::http::error">
      <a href="Raven/Transport/HTTP/Error.html">Error</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

</div>

<div id="main-content">
<h1>raven.cr <a href="https://travis-ci.org/Sija/raven.cr" target="_blank"><img src="https://travis-ci.org/Sija/raven.cr.svg?branch=master" alt="Build Status"/></a></h1>

<p>A client and integration layer for the <a href="https://github.com/getsentry/sentry" target="_blank">Sentry</a> error reporting API.</p>

<p>Based on fine <a href="https://github.com/getsentry/raven-ruby" target="_blank">raven-ruby</a> gem
from folks at <a href="https://github.com/getsentry" target="_blank">@getsentry</a>.</p>

<h2>Status</h2>

<h3>Stability</h3>

<p>LGTM (aside of few <code>FIXME</code> flags <a href="https://github.com/sija/raven.cr/search?q=FIXME" target="_blank">here and there</a>…)
yet there are no tests written, so use it at your own risk! - or kindly send a PR :)</p>

<h3>Feature support</h3>

<ul><li>[x] Processors (data scrubbers)</li><li>[x] Interfaces (Message, Exception, Stacktrace, User, HTTP, ...)</li><li>[x] Contexts (tags, extra, <code>os</code>, <code>runtime</code>)</li><li>[x] Breadcrumbs</li><li>[x] Integrations (<a href="https://github.com/kemalcr/kemal" target="_blank">Kemal</a>, <a href="https://github.com/mperham/sidekiq.cr" target="_blank">Sidekiq.cr</a>)</li><li>[x] Async support</li><li>[x] User Feedback (<code>Raven.send_feedback</code> + Kemal handler)</li></ul>

<h3>TODO</h3>

<ul><li>[ ] Tests</li><li>[ ] Exponential backoff in case of connection error</li><li>[ ] Caching unsent events for later send</li><li>[ ] Catching app crashes, kind of a bin wrapper perhaps?</li></ul>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class='language-yaml'>dependencies:
  raven:
    github: sija/raven.cr</code></pre>

<h2>Usage</h2>

<pre><code class='language-crystal'><span class="k">require</span> <span class="s">&quot;raven&quot;</span></code></pre>

<h3>Raven only runs when SENTRY_DSN is set</h3>

<p>Raven will capture and send exceptions to the Sentry server whenever its DSN is set. This makes environment-based configuration easy - if you don't want to send errors in a certain environment, just don't set the DSN in that environment!</p>

<pre><code class='language-bash'># Set your SENTRY_DSN environment variable.
export SENTRY_DSN=http://public:secret@example.com/project-id</code></pre>

<pre><code class='language-crystal'><span class="c"># Or you can configure the client in the code &#40;not recommended - keep your DSN secret&#33;&#41;</span>
<span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.dsn <span class="o">=</span> <span class="s">&quot;http://public:secret&#64;example.com/project-id&quot;</span>
<span class="k">end</span></code></pre>

<h3>Raven doesn't report some kinds of data by default.</h3>

<p>Raven ignores some exceptions by default - most of these are related to 404s or controller actions not being found. <a href="https://github.com/sija/raven.cr/blob/master/src/raven/configuration.cr" target="_blank">For a complete list, see the <code>IGNORE_DEFAULT</code> constant</a>.</p>

<p>Raven doesn't report POST data or cookies by default. In addition, it will attempt to remove any obviously sensitive data, such as credit card or Social Security numbers. For more information about how Sentry processes your data, <a href="https://docs.sentry.io/clients/ruby/config/" target="_blank">check out the documentation on the <code>processors</code> config setting.</a></p>

<h3>Call</h3>

<p>Raven supports two methods of capturing exceptions:</p>

<pre><code class='language-crystal'><span class="t">Raven</span>.capture <span class="k">do</span>
  <span class="c"># capture any exceptions which happen during execution of this block</span>
  <span class="n">1</span> <span class="o">/</span> <span class="n">0</span>
<span class="k">end</span>

<span class="k">begin</span>
  <span class="n">1</span> <span class="o">/</span> <span class="n">0</span>
<span class="k">rescue</span> exception : <span class="t">DivisionByZero</span>
  <span class="t">Raven</span>.capture(exception)
<span class="k">end</span></code></pre>

<h3>More configuration</h3>

<p>You're all set - but there's a few more settings you may want to know about too!</p>

<h4>DSN</h4>

<p>While we advise that you set your Sentry DSN through the <code>SENTRY_DSN</code> environment
variable, there are two other configuration settings for controlling Raven:</p>

<pre><code class='language-crystal'><span class="c"># DSN can be configured as a config setting instead.</span>
<span class="c"># Place in config/initializers or similar.</span>
<span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.dsn <span class="o">=</span> <span class="s">&quot;your_dsn&quot;</span>
<span class="k">end</span></code></pre>

<p>And, while not necessary if using <code>SENTRY_DSN</code>, you can also provide an <code>environments</code>
setting. Raven will only capture events when <code>KEMAL_ENV</code> matches an environment in the list.</p>

<pre><code class='language-crystal'><span class="t">Raven</span>.configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
  config.environments <span class="o">=</span> <span class="s">%w(staging production)</span>
<span class="k">end</span></code></pre>

<h4>async</h4>

<p>When an error or message occurs, the notification is immediately sent to Sentry. Raven can be configured to send asynchronously:</p>

<pre><code class='language-crystal'><span class="c"># define your own handler</span>
config.async <span class="o">=</span> ->(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span>) {
  spawn { <span class="t">Raven</span>.send_event(event) }
}
<span class="c"># or use default implementation based on fibers &#40;i.e. the one above&#41;</span>
config.async <span class="o">=</span> <span class="n">true</span></code></pre>

<p>If the <code>async</code> callback raises an exception, Raven will attempt to send synchronously.</p>

<p>We recommend creating a background job, using your background job processor, that will send Sentry notifications in the background. Rather than enqueuing an entire <code><a href="Raven/Event.html">Raven::Event</a></code> object, we recommend providing the <code>Hash</code> representation of an event as a job argument. Here’s an example for Sidekiq.cr:</p>

<pre><code class='language-crystal'>config.async <span class="o">=</span> ->(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span>) {
  <span class="c"># enqueue the job with a hash...</span>
  <span class="t">SentryJob</span>.async.perform(event.to_hash)
  <span class="c"># or with JSON string</span>
  <span class="c"># SentryJob.async.perform&#40;event.to_json&#41;</span>
}

<span class="k">class</span> <span class="t">SentryJob</span>
  <span class="k">include</span> <span class="t">Sidekiq</span><span class="t">::</span><span class="t">Worker</span>
  sidekiq_options <span class="k">do</span> <span class="o">|</span>job<span class="o">|</span>
    job.queue <span class="o">=</span> <span class="s">&quot;sentry&quot;</span>
    job.retry <span class="o">=</span> <span class="n">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">perform</span>(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span><span class="t">::</span><span class="t">HashType</span>)
    <span class="t">Raven</span>.send_event(event)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h4>transport_failure_callback</h4>

<p>If Raven fails to send an event to Sentry for any reason (either the Sentry server has returned a 4XX or 5XX response), this Proc will be called.</p>

<pre><code class='language-crystal'>config.transport_failure_callback <span class="o">=</span> ->(event : <span class="t">Raven</span><span class="t">::</span><span class="t">Event</span><span class="t">::</span><span class="t">HashType</span>) {
  <span class="t">AdminMailer</span>.async.perform(<span class="s">&quot;Oh god, it&#39;s on fire&#33;&quot;</span>, event)
}</code></pre>

<h4>Context</h4>

<p>Much of the usefulness of Sentry comes from additional context data with the events. Raven makes this very convenient by providing methods to set thread local context data that is then submitted automatically with all events.</p>

<p>There are three primary methods for providing request context:</p>

<pre><code class='language-crystal'><span class="c"># bind the logged in user</span>
<span class="t">Raven</span>.user_context email: <span class="s">&quot;foo&#64;example.com&quot;</span>

<span class="c"># tag the request with something interesting</span>
<span class="t">Raven</span>.tags_context interesting: <span class="s">&quot;yes&quot;</span>

<span class="c"># provide a bit of additional context</span>
<span class="t">Raven</span>.extra_context happiness: <span class="s">&quot;very&quot;</span></code></pre>

<p>For more information, see <a href="https://docs.sentry.io/clients/ruby/context/" target="_blank">Context</a>.</p>

<h2>More Information</h2>

<ul><li><a href="https://docs.sentry.io/clients/ruby" target="_blank">Documentation</a></li><li><a href="https://github.com/sija/raven.cr/issues" target="_blank">Bug Tracker</a></li><li><a href="https://github.com/sija/raven.cr" target="_blank">Code</a></li><li><a href="https://groups.google.com/group/getsentry" target="_blank">Mailing List</a></li><li><a href="irc://irc.freenode.net/sentry" target="_blank">IRC</a> (irc.freenode.net, #sentry)</li></ul>

<h2>Development</h2>

<pre><code>crystal spec</code></pre>

<h2>Contributing</h2>

<ol><li><a href="https://github.com/sija/raven.cr/fork" target="_blank">Fork it</a></li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new <a href="https://github.com/sija/raven.cr/pulls" target="_blank">Pull Request</a></li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/sija" target="_blank">sija</a> Sijawusz Pur Rahnama - creator, maintainer</li></ul>
</div>
</body>
</html>
